// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  // output   = "../generated/prisma-client"
}

datasource db {
  provider = "postgresql"
}

// User model for authentication
model User {
  id        Int       @id @default(autoincrement())
  firstName String    @map("first_name")
  lastName  String    @map("last_name")
  email     String    @unique
  password  String // Hashed password
  gender    String?
  role      Role      @default(USER)
  bookings  Booking[]
  reviews   Review[]
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")

  @@map("users")
}

// Role enum for user authorization
enum Role {
  USER
  ADMIN
}

// City model
model City {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  country   String
  countryId String // STRING (e.g., "MX", "US", "CO")
  hotels    Hotel[]
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("cities")
}

// Hotel model
model Hotel {
  id          Int       @id @default(autoincrement())
  name        String
  description String    @db.Text
  price       Float
  address     String
  lat         Float
  lon         Float
  cityId      Int       @map("city_id")
  city        City      @relation(fields: [cityId], references: [id], onDelete: Cascade)
  images      Image[]
  bookings    Booking[]
  reviews     Review[]
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  @@map("hotels")
}

// Image model (optional)
model Image {
  id        Int      @id @default(autoincrement())
  url       String
  hotelId   Int      @map("hotel_id")
  hotel     Hotel    @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("images")
}

// Booking model
model Booking {
  id        Int      @id @default(autoincrement())
  checkIn   DateTime @map("check_in") @db.Date
  checkOut  DateTime @map("check_out") @db.Date
  userId    Int      @map("user_id")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  hotelId   Int      @map("hotel_id")
  hotel     Hotel    @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("bookings")
}

// Review model
model Review {
  id        Int      @id @default(autoincrement())
  rating    Int // 1-5
  comment   String   @db.Text
  userId    Int      @map("user_id")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  hotelId   Int      @map("hotel_id")
  hotel     Hotel    @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("reviews")
}
